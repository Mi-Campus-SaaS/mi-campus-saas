services:
  otel-collector:
    image: otel/opentelemetry-collector:latest
    command: ["--config=/etc/otel-collector-config.yaml"]
    volumes:
      - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml
    ports:
      - "14317:4317"   # OTLP gRPC receiver (host 14317)
      - "14318:4318"   # OTLP HTTP receiver (host 14318)
      - "55679:55679" # zpages extension
    networks:
      - otel-network

  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686" # Jaeger UI
      - "14268:14268" # Jaeger collector HTTP
      - "14250:14250" # Jaeger collector gRPC
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    networks:
      - otel-network

  postgres:
    image: postgres:17
    container_name: micampus-postgres
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=micampus
    ports:
      - "5432:5432"
    volumes:
      - micampus-pgdata:/var/lib/postgresql/data
    networks:
      - otel-network

  redis:
    image: redis:7-alpine
    container_name: micampus-redis
    command: ["redis-server", "--appendonly", "yes"]
    ports:
      - "6379:6379"
    volumes:
      - micampus-redis-data:/data
    networks:
      - otel-network

networks:
  otel-network:
    driver: bridge
volumes:
  micampus-pgdata:
  micampus-redis-data:
